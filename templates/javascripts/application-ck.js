// Public: The main entry point to the frontend application.
window.App={username:null,token:null,init:function(){this.commandbar=new window.CommandBarView;this.replies=new window.RepliesView},request:function(e,t,n){$.ajax(e,{type:"POST",data:t,success:function(e){n(null,e)},error:function(e,t,r){n(r,null)}})},submitUsername:function(e){var t={username:e},n=this,r=function(e,t){if(e){console.log(e);n.addReply("#user-failed",{})}else{console.log(t);n.addReply("#user-success",t);n.username=t.login}};this.request("/github/identity/username",t,r)},submitToken:function(e){var t={username:this.username,token:e},n=this,r=function(t,r){if(t){console.log(t);n.addReply("#token-failed",{})}else{console.log(r);n.addReply("#token-success",r);n.token=e}};this.request("/github/identity/token",t,r)},addReply:function(e,t){var n=new window.ReplyView({template:e,model:t});if(t.avatar_url){$(".js-avatar img").attr("src",t.avatar_url);$(".js-avatar").fadeIn()}this.replies.add(n)}};window.RepliesView=Backbone.View.extend({el:".js-replies",add:function(e){var t=this;this.$(".message").fadeOut("fast",function(){t.$el.empty();t.$el.append(e.render().el)})}});window.ReplyView=Backbone.View.extend({className:"message",initialize:function(e){this.template=_.template($(e.template).html())},render:function(){this.$el.html(this.template(this.model));return this}});window.CommandBarView=Backbone.View.extend({el:".js-command-bar",events:{"keypress .js-command-input":"submit"},initialize:function(){this.commandinput=this.$(".js-command-input");this.commandinput.focus()},submit:function(e){if(e.keyCode!=13)return;if(!this.commandinput.val())return;var t=this.commandinput.val();this.commandinput.val("");!window.App.username&&!window.App.token?window.App.submitUsername(t):window.App.username&&!window.App.token&&window.App.submitToken(t)}});